### 多线程介绍：【线程、进程、线程本质】

> 线程是什么？和进程什么关系？

- 进程是指在系统中正在运行的一个应用程序；每个进程之间是相互独立的；
- 一个进程要想执行任务，必须得有线程（每个进程至少要有一条线程）
- 一个进程的所有任务都在线程中执行
- 线程的内部是串行的

---

> 什么是多线程？多线程的作用？

- 一个会去执行一个任务；多个线程可以执行多个任务；
- 一个进程中可以开启多条线程，多条线程可以并行执行不同的任务；
- 多线程的好处是可以提高程序执行的效率；还能适当提高资源利用率；

---

> 多线程的本质

- cpu 同时只能运行一条线程，只不过通过时间片轮转，也就是CPU快速在多个线程之间调度（切换），如果CPU调度线程的时间足够快，就造成了多线程并发执行的假象。

---

> 主线程的作用？

- 主要用来处理UI事件，例如点击、滚动、拖拽；显示/刷新UI界面，但是如果把处理UI的操作放在子线程会有bug出现
- 什么是主线程：一个iOS程序运行后，默认会开启1条线程，这条线程就是主线程，因为它主要用来处理UI线程，
所以也可以成为UI线程
- 什么操作不应该放在主线程：耗时的操作
- 主线程常用命令

// 获取主线程 [NSThread mainThread];(number = 1,name = main)

// 判断是否主线程 [NSThread isMainThread]

// 打印当前线程 [NSThread currentThread];

---

### 多线程介绍：【线程缺点】

> 多线程的缺点

- 创建线程是有开销的，iOS下主要成本包括：内核数据结构（大约1KB）、
栈空间（子线程512KB、主线程1MB，也可以使用 -setStacjSize： 设置，但是必须是4K的倍数，而且最小是16K），
创建线程大约需要90毫秒的创建时间
- 如果开启大量的线程，会降低程序的性能
- CPU 会在N多线程之间调度，CPU会累死，消耗大量的CPU资源
- 每条线程被调度执行的频次被降低（线程的执行效率下降）

---

> 存在安全隐患的地方

- 一块资源可能被多个线程共享，也就是多个线程可能会访问到一块资源
- 比如多个线程访问同一个对象，同一个变量，同一个文件
- 当多线程访问同一块资源的时候，很容易引发数据错乱和数据安全问题

---

### 多线程介绍：【线程状态】

> 线程的状态

- 就绪状态（Runnable）：情况1，当调用start方法，系统会将线程放入可调度线程池，
只要线程被放入了调度池中，那线程就会变成就绪状态；情况2，当CPU调度其他线程的时候，当前线程就会变成就绪状态；
- 运行状态（Running）：当线程被CPU调度（执行）的时候，那线程的状态就会变成运行状态
- 阻塞状态（Blocked）：当线程被sleep、或者等待同步锁、或者阻塞的时候，会变成阻塞状态
- 死亡状态（Dead）：当线程任务执行完毕、强制退出的时候，就会进入死亡状态

> 注意：当线程被锁住的时候，该线程就会被移出可调度线程池，这样做可以提高效率；
因为不移除的话，每次调用线程的时候还需要判断线程是否可以执行；

NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil];
[thread start];
// 第一行代码是创建线程（创建线程的时候，系统会在内存中给线程分配一段存储空间）
// 第二行代码是调用start方法