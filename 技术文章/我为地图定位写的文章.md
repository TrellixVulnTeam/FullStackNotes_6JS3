### 了解定位先要了解几个关键词
* [手机GPS全球定位系统](https://zh.wikipedia.org/wiki/%E5%85%A8%E7%90%83%E5%AE%9A%E4%BD%8D%E7%B3%BB%E7%BB%9F)
* WIFI定位
* [RSSI](https://en.wikipedia.org/wiki/Received_signal_strength_indication)

[摘录]GPS系统由美国政府于1970年代开始进行研制，1978年2月首次发射，并于1994年全面建成。使用者只需拥有GPS接收芯片即可使用该服务。GPS信号分为民用的标准定位服务（SPS，Standard Positioning Service）和军用的精确定位服务（PPS，Precise Positioning Service）两类。由于GPS无须任何授权即可任意使用，原本美国因为担心敌对国家或敌对组织会利用GPS对美国发动攻击，故在民用讯号中人为地加入选择性误差（即SA政策，Selective Availability）以降低其精确度，使其最终定位精确度大概在100米左右；军规的精度在（20～1英尺）以下。2000年以后，比尔·克林顿政府决定取消对民用讯号的干扰。因此，现在民用GPS也可以达到（20～1英尺）左右的定位精度。

[摘录]RSSI表示在天线之后接收无线电接收到的功率电平以及可能的电缆损耗。因此，RSSI值越大，信号越强。因此，当RSSI值以负数形式表示（例如-100）时，该值越接近0，则接收信号越强。

### 其他定位了解
* [谷歌纵横](https://zh.wikipedia.org/wiki/Google%E5%AE%9A%E4%BD%8D)

### iPhone通过WIfi无网定位原理
* 说说为什么 iPhone 可以在无网状态下定位 @Ts8zs ： 当iPhone 获取到WIFI 定位结果后，会在客户端保存一份定位结果，比如「（x1，y1），BSSID1，BSSID2。。。BSSIDn」。即便 iPhone 没有联网，只要扫描到其中一个 BSSID，iOS 即认为此时的位置是（x1，y1）PS：不连接 WIFI，手机也可以获取 WIFI 的 BSSID 和 RSSI。

### 常见的几种定位
* ip地位（从你登陆的IP地址能查询到你当前的城市、街道甚至建筑物）
* 手机蜂窝网络定位（Cellular(蜂窝网络)基站(依托手机移动网络)定位是几十到几百米）
* gps定位（精确到米）
* wifi定位

定位模式有3种：
1、卫星定位
（1）GPS卫星定位：iPhone 3G/3GS/4/5，3G/4G版的iPad 支持
（2）GLONASS卫星定位：iPhone 4/5，3G/4G版的iPad 3/4/Mini 支持
2、手机基站定位
同1.1GPS卫星定位，即iPhone 3G/3GS/4/5，3G/4G版的iPad 支持
3、WIFI定位
所有iOS设备，包括Mac电脑也支持。

---

* 手机基站定位（手机蜂窝网络定位）

原理：每个手机基站都有一个标识符，iPhone或3G iPad可以搜集周围所有收到信号的基站和它们的标识符，通过联网发送到苹果云端服务器，再由服务器根据这些基站的的位置信息查询并计算出当前位置，然后返回给手机。因为基站信号辐射范围大，所以误差也大，在500米 ~ 几公里.

特点：定位速度最快, 耗电最少，误差几百上千米.

---

* iPhone重要基站定位（无网基站定位）

iOS优化：传统的基站定位需要连接云端服务器，产生网络流量，iOS 4对其进行了优化，可以在没有网络连接时支持无网定位，因为苹果预先已经将一些重要基站（几十公里选一个）提前存储在iOS系统中，在无网情况下，不用上网也能通过这些本地基站信息定位到用户位置，但这个误差范围更大，在10公里到50公里。

无网基站定位的前提是：您的手机能接受到内置在手机中的那些“重要基站”的信号，不一定是您手机所属运营商，只要能收到信号就可以了。 

---

* WIFI定位:

原理
和基站定位原理差不多, iOS设备（或者Mac电脑）通过无线网卡手机周围所有的WIFI热点（不需要连接上，只需要有信号就行），获得它们的MAC地址，然后到苹果云端服务器查询这个热点是否已经登记，登记的话它的位置是多少，最后通过计算（多个热点折中）得到当前位置并返回给用户。只要收到手机信号的地方都可以基站定位，所以室内室外一样。

特点：WIFI定位速度、耗电和精度都介于基站和GPS之间，精度大概在几十米。（注意，WIFI定位的支持范围没有基站定位广，但是苹果的云端服务器一直在不断增加新的热点信息，使得热点定位支持的地区越来越多）

---

* 无网WIFI定位：

传统的WIFI定位需要网络，但是iOS对其进行了优化，可以实现无网WIFI定位。原理时iOS设备在您有网络连接时，会大致定位出您的位置，并自动下载您所在地区周围（几个街区宽度或者更多）所有的WIFI热点的信息到本地。之后，当您在周围行走并WIFI定位的时候，即使没有网络，iOS照样可以利用之前下载的WIFI热点信息定位出您的位置。
这也是为什么有人号称WIFI无网可定位的原因，但注意：无网WIFI定位的前提是您在这个区域附近曾经成功上过网，如果初次到一个陌生的地方，是无法定位的哦。

关于自动下载的热点个数和范围，这个是苹果根据当地热点的密度动态决定的，当地热点很多时（如市中心），可能只下载几条街道范围的所有热点，当地热点密度很小时（例如海滨城市），可能会下载整个城市的所有热点。

---

* GPS定位:

（GLONASS原理与此类似，不做额外介绍）

原理
这个是美国军方搞的, 军民两用, 但仍然完全受军方控制(比如可以随时随地设置某个地区收到的信号与否及其精度), 其原理就是:利用天上的卫星(共24颗)不断地广播信号, 地面的GPS接收设备收到信号后, 通过分析多个卫星信号，就可以计算出地球坐标, GPS保证全球任何一个地方(98%)都可以同时收到至少4个卫星的信号, 从而可以准确确定您的经纬度以及海拔位置. GPS定位精度可达10米以内, 不过这是美国军方控制的, 战争时期可能变的不稳定或者误报. (不过我国也有自己的系统, 北斗系统, 目前已经亚洲的覆盖, 还在推广中)

卫星定位必须要能收到卫星信号，因为卫星信号都是很微弱的，虽然iPhone 4开始提升了GPS硬件的灵敏度，但仍然需要在窗户旁，或者户外使用，才能确保卫星信号的强度和稳定性。

与基站定位和WIFI定位相比，GPS耗电最大，速度最慢，但是精度最高。

而iPhone的GPS与纯粹的GPS定位不同, 称为A-GPS, 即辅助GPS.(比GPS更优，不过GPS也分芯片和性能的，不是说所有的AGPS比所有的GPS都好)

因为GPS定位中最耗时、最耗电的就是获取当前天上的卫星信息，哪些卫星可见、在什么位置、时钟是多少等等，这个过程可能花费数十秒甚至几分钟，而AGPS就是利用网络，首先将基站定位或者WIFI定位获得的大概位置发到远程服务器，有服务器进行查询和计算，得出这个位置下当前卫星信息，反馈给iOS设备，iOS设备就可以直接用这些信息来接受卫星信号，不用自己去扫描分析了。这样可以极大提高定位速度，将初次定位时间缩短到1~2秒完成。

A-GPS优点是定位快，缺点是需要网络，但也只是在初次定位时需要网络，因为一旦卫星信息返回，在有限时间和范围内，这些信息无须改变，之后的GPS定位就不再需要联网，都是直接用这些卫星参数接受信息了。

---

* 定位的顺序
  
在iOS设备上，上述定位方式会综合应用，一般地，可能先按照最快的“无网基站定位”返回一个位置，当有网络连接时，在用有网基站定位更新位置，然后，利用AGPS上网查询卫星星图，最后，在能收到GPS信号的情况下，转为使用GPS定位。

根据当前信号情况和网络环境，iOS可能在上述方式之间反复迭代，不一定一致特定步骤或者方式，而且随着iOS升级，定位顺序和规则可能改变。

---

iOS设备能提供3种不同途径进行定位：Wifi, 蜂窝式移动电话基站, GPS卫星

iOS 不像Android系统在定位服务编程时，可以指定采用哪种途径进行定位。iOS的API把底层这些细节屏蔽掉了，开发人员和用户并不知道现在设备是采用 哪种方式进行定位的，iOS系统会根据设备的情况和周围的环境，采用一套最佳的解决方案。这个方案是这样的，如果能够接收GPS信息，那么设备优先采用 GPS定位，否则采用Wifi或蜂窝基站定位，在Wifi和蜂窝基站之间优先使用Wifi，如果无法连接Wifi才使用蜂窝基站定位。

总体来说GPS定位优点是准确、覆盖面广阔，缺点是不能被遮挡（例如：在建筑物里面收不到GPS卫星信号）、GPS开启后比较费电。蜂窝基站不仅误差比较大，而且会耗费用户流量费。而Wifi定位是最经济实惠的。

### 到底是iPhone自带的地图定位准还是高德或百度地图定位准？

### 下载手机周围的wifi热点信息，需要连接有网wifi来下载吗？还是通过能上网的手机就行？

### 根据不同的定位场景，使用不同的定位方式
* 室内定位（wifi定位，gps定位）
* 室外定位（手机蜂窝定位，gps定位）

### 参考文章
* [移动设备究竟是怎样仅仅使用 Wi-Fi 来定位的？](https://www.zhihu.com/question/20355764)
  * [备用链接](https://app.yinxiang.com/shard/s35/nl/9757212/ad87a21b-7dfa-4dcb-87f7-7657c123dd10)
* [iOS定位原理和使用建议](https://blog.csdn.net/doubleuto/article/details/40080533)
  * [备用链接](https://app.yinxiang.com/shard/s35/nl/9757212/7ccfc1ae-2dff-4204-9af8-410c33779a4b?title=iOS%E5%AE%9A%E4%BD%8D%E5%8E%9F%E7%90%86%E5%92%8C%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE_YearnWang%E7%9A%84%E4%B8%93%E6%A0%8F-CSDN%E5%8D%9A%E5%AE%A2)
* [iOS定位的3种方式(方式)](https://www.jianshu.com/p/4e0ce298117b)